<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>MAKER â€“ Polytechnische Einheitsschule</title>

  <meta name="theme-color" content="#000000" />
  <meta name="color-scheme" content="dark light" />

  <!-- PWA -->
  <link rel="manifest" href="./manifest.json" />

  <!-- iOS PWA basics (no external deps) -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <link rel="stylesheet" href="./app.css" />
</head>

<body>
  <noscript>
    <div style="padding:16px; font-family: system-ui, sans-serif; line-height:1.4;">
      <strong>MAKER braucht JavaScript.</strong><br />
      Bitte aktiviere JavaScript oder Ã¶ffne die App in einem Browser, der es unterstÃ¼tzt.
    </div>
  </noscript>

  <!-- Gatekeeper (linear entry) -->
  <div id="gatekeeper" class="hidden" aria-live="polite">
    <div class="brand">MAKER</div>
    <div class="sub-brand">Polytechnische Einheitsschule</div>

    <button
      id="mode-btn-gate"
      class="pill mode-btn"
      type="button"
      aria-label="Modus wechseln"
      title="Modus"
    >ğŸŒ</button>

    <div id="start-circle" aria-hidden="true"></div>

    <div id="gate-prompt" role="button" tabindex="0">Sag â€Startâ€œ oder tippe</div>

    <button
      id="gate-fallback-btn"
      class="pill big-start"
      type="button"
      aria-label="Start"
      title="Start"
    >
      ğŸ‘† Start
    </button>
  </div>

  <!-- App shell (AR layer mounts inside #app by motor_ar.js) -->
  <div id="app" class="hidden">
    <div class="topbar">
      <button
        id="mode-btn-app"
        class="pill mode-btn"
        type="button"
        aria-label="Modus wechseln"
        title="Modus"
      >ğŸŒ</button>

      <button
        id="reset-btn"
        class="pill danger"
        type="button"
        aria-label="ZurÃ¼cksetzen"
        title="Reset"
      >ğŸ”„ Reset</button>
    </div>

    <div id="core-display">
      <div id="concept-image"></div>
      <div id="focus-word"></div>
    </div>

    <div id="prompt" aria-live="polite"></div>

    <div id="interaction-area"></div>

    <button
      id="mic-button"
      type="button"
      aria-label="Sprechen"
      title="Sprechen"
      style="display:none;"
    >ğŸ¤ Sprechen</button>

    <div id="feedback" aria-live="polite"></div>
    <div id="diagnostic" style="display:none;"></div>
  </div>

  <!-- âœ… Script order is CRITICAL -->
  <script src="./app.js" defer></script>
  <script src="./motor_ar.js" defer></script>

  <script>
    // a11y-gate.js (inline): keyboard fallback for the gate prompt
    // Comments in English by project rule.
    (function () {
      var gp = document.getElementById("gate-prompt");
      if (!gp) return;

      gp.addEventListener("keydown", function (e) {
        var k = e.key || "";
        if (k === "Enter" || k === " " || k === "Spacebar") {
          e.preventDefault();
          gp.click();
        }
      });
    })();
  </script>

  <script>
    // sw-register.js (inline): offline-first + update-safe behavior
    // Comments in English by project rule.
    (function () {
      if (!("serviceWorker" in navigator)) return;

      navigator.serviceWorker.register("./sw.js", { scope: "./" })
        .then(function () {})
        .catch(function () {});

      // Reload once when the new SW takes control to avoid "stuck old version"
      var reloaded = false;
      navigator.serviceWorker.addEventListener("controllerchange", function () {
        if (reloaded) return;
        reloaded = true;
        location.reload();
      });
    })();
  </script>
</body>
</html>
